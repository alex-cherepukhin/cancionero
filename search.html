<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Canciones</title>
    <link rel="stylesheet" href="index_styles.css">
</head>
<body>
    <div class="container">
        <div class="header-container">
            <a href="https://www.iglesialuzalasnaciones.es/" target="_blank">
                <img src="iglesia.png" alt="Luz a las naciones">
            </a>
            <h1>Canciones</h1>
        </div>
        <nav class="alpha-nav">
            <input type="text" id="searchBar" placeholder="Texto de búsqueda">
            <button id="searchButton">&nbsp;Buscar&nbsp;</button>
        </nav>
        <div id="results"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
    <script>
        let idx; // Глобальная переменная для индекса

        // Загрузка JSON-файла и создание индекса
        fetch('songs.json')
            .then(response => response.json())
            .then(data => {
                idx = lunr(function () {
                    this.field('title');
                    this.field('text');
                    this.ref('id');

                    data.forEach(song => {
                        this.add(song);
                    });
                });

                // Добавляем обработчик события на кнопку поиска
                document.getElementById('searchButton').addEventListener('click', function() {
                    performSearch();
                });

                // Также добавляем обработчик на нажатие клавиши Enter в поле ввода
                document.getElementById('searchBar').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            });

        // Функция для выполнения поиска
        function performSearch() {
            const query = document.getElementById('searchBar').value;
            const results = idx.search(query);
            const resultContainer = document.getElementById('results');
            resultContainer.innerHTML = ''; // Очистка предыдущих результатов

            if (results.length === 0) {
                resultContainer.innerHTML = '<p>No se encontraron resultados.</p>';
            } else {
                results.forEach(result => {
                    const song = data.find(song => song.id === result.ref);
                    const link = document.createElement('a');
                    link.href = song.url;
                    link.textContent = song.title;
                    link.target = '_blank'; // Открыть в новой вкладке
                    resultContainer.appendChild(link);
                    resultContainer.appendChild(document.createElement('br'));
                });
            }
        }
    </script>
</body>
</html>
